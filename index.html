<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Optimizador de Rutas de Gasolina</title>
    <meta name="description" content="Encuentra las gasolineras más baratas en tu ruta y planifica tus paradas para ahorrar dinero en cada viaje.">

    <!-- Preconnect to key origins for performance -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://corsproxy.io">
    <link rel="preconnect" href="https://unpkg.com">
    <link rel="preconnect" href="https://a.tile.openstreetmap.org" crossorigin>
    <link rel="preconnect" href="https://b.tile.openstreetmap.org" crossorigin>
    <link rel="preconnect" href="https://c.tile.openstreetmap.org" crossorigin>
    
    <link rel="preload" href="/mapa-placeholder.png" as="image" fetchpriority="high">
    <link rel="preload" href="https://b.tile.openstreetmap.org/6/31/24.png" as="image" fetchpriority="high">
    <link rel="preload" href="https://b.tile.openstreetmap.org/6/32/23.png" as="image" fetchpriority="high">
    <link rel="preload" href="https://a.tile.openstreetmap.org/6/31/23.png" as="image" fetchpriority="high">
    <link rel="preload" href="https://a.tile.openstreetmap.org/6/30/24.png" as="image" fetchpriority="high">
    <link rel="preload" href="https://c.tile.openstreetmap.org/6/30/23.png" as="image" fetchpriority="high">
    <!-- PWA Manifest and Theme Color -->
    <meta name="theme-color" content="#4f46e5"/>
    <link rel="apple-touch-icon" href="https://placehold.co/192x192/4f46e5/white?text=⛽️">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-status-bar-style" content="black">
    <meta name="mobile-web-app-title" content="GasRuta">
    <link rel="manifest" href="/manifest.json">
    
    <!-- Scripts (deferred to be non-blocking) -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <script rel="preload" src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous" defer></script>
    <script rel="preload" src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin="" defer></script>
    <script rel="preload" src='https://unpkg.com/@turf/turf@6/turf.min.js' defer></script>

    <!-- LeafletJS for Map (synchronous) -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
    
    <!-- Google Fonts (asynchronous) -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet" media="print" onload="this.media='all'">
    <noscript><link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet"></noscript>

 <style>

        /* Custom styles for the app */
        :root {
            --bs-body-font-family: 'Inter', sans-serif;

            /* Accent color */
            --app-accent: #4138c2;
            --bs-primary: #4138c2;
            --bs-primary-rgb: 65,56,194;

            /* Button / control fallbacks */
            --bs-btn-bg: var(--bs-primary);
            --bs-btn-border-color: var(--bs-primary);
            --bs-link-color: var(--bs-primary);
            
        }
        .mi-parrafo {
          font-size: 0.75rem;
          padding-left: 4px;
          padding-right: 4px;

        }
        /* Ensure primary-based components pick the custom accent */
        .btn-primary {
            background-color: var(--bs-primary) !important;
            border-color: var(--bs-primary) !important;
            color: #fff;
        }
        .btn-primary:hover,
        .btn-primary:focus {
            background-color: color-mix(in srgb, var(--bs-primary) 85%, black) !important;
            border-color: color-mix(in srgb, var(--bs-primary) 85%, black) !important;
            box-shadow: 0 0 0 .25rem rgba(var(--bs-primary-rgb), .15);
        }



        /* Form controls that use accent when active/checked */
        .form-check-input:checked {
            background-color: var(--bs-primary);
            border-color: var(--bs-primary);
        }
        .form-range::-webkit-slider-thumb {
            background: var(--bs-primary);
            border: 2px solid #fff;
        }
        .form-range::-moz-range-thumb {
            background: var(--bs-primary);
            border: 2px solid #fff;
        }

        /* Loader accent */
        .loader {
            border: 5px solid #f3f3f3;
            border-top: 5px solid var(--app-accent);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
        }

        /* Preserve original rules below */
        html[data-bs-theme="dark"] {
            --bs-body-bg: #121212;
            --bs-tertiary-bg: #2d2d2d; 
            --bs-body-color: #e0e0e0;
            --bs-border-color: #424242;
        }
        p {
            margin-bottom: 1px;
        }

        body {
            display: flex;
            height: 100vh;
            overflow: hidden;
        }
        #sidebar {
            width: 400px;
            min-width: 350px;
            height: 100%;
            overflow-y: auto;
            z-index: 20;
            transition: transform 0.3s ease-in-out;
        }
        #map {
         height: 100%;
            width: 100%;
            z-index: 10;
        
    /* Añade el placeholder aquí directamente */
            background-color: #e0e0e0; 
    background-image: url('/mapa-placeholder.png');
    background-size: cover;
    background-position: center;
}       
@font-face {
  font-family: "bootstrap-icons";
  src: url("https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/fonts/bootstrap-icons.woff2?dd67030699838ea613ee6dbda90effa6") format("woff2");
  font-display: swap; /* Añade esto */
}
        @media (max-width: 768px) {
            body {
                flex-direction: column;
            }
            #sidebar {
                width: 100%;
                height: 65vh; /* Adjust height for mobile */
                min-width: 100%;
                border-bottom: 1px solid var(--bs-border-color);
            }
            #map-container {
                height: 40vh;
                width: 100%;
                background-color: #e0e0e0; /* Un color de fondo simple */
                /* O mejor, una imagen estática ligera del mapa */
                background-image: url('/mapa-placeholder.png');
                background-size: cover;
                background-position: center;
            }

        }
        .leaflet-popup-content-wrapper {
            border-radius: 8px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Estilos para las tarjetas de gasolineras */
        .station-card {
            transition: all 0.2s ease;
            position: relative;
        }
        
        .station-card:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .station-card.selected {
            border-left: 4px solid var(--bs-primary);
            background-color: #f8f9ff;
        }
        
        .selection-badge {
            position: absolute;
            top: 8px;
            right: 8px;
            background-color: var(--bs-primary);
            color: white;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            font-weight: bold;
            opacity: 0;
            transition: opacity 0.2s ease;
        }
        
        .station-card.selected .selection-badge {
            opacity: 1;
        }
    </style>
</head>
<body class="bg-light">

    <!-- Sidebar for controls and results -->
    <aside id="sidebar" class="bg-body shadow-lg p-3 d-flex flex-column">
        <div class="flex-shrink-0">
            <div class="d-flex justify-content-between align-items-center mb-1">
                <p class="h4 fw-bold text-body-emphasis">⛽Ahorra en tu viaje </p>
                <div class="d-flex align-items-center">

                    <button id="settings-btn" class="btn btn-light" title="Abrir configuración">
                        <i class="bi bi-gear-fill"></i>
                    </button>
                                        <button id="theme-toggle" class=" border-0 bg-transparent p-2 me-2" title="Cambiar modo oscuro/claro">
                        <i class="bi bi-moon-stars-fill fs-5"></i>
                    </button>
                </div>
            </div>
            <!-- <p class="text-muted mb-3">Encuentra las gasolineras más baratas.</p>-->
            
            <!-- Settings Panel (hidden by default) -->
            <div id="settings-panel" class="d-none bg-body-tertiary p-3 rounded-3 mb-4 border">
                <h3 class="fw-bold h5 mb-2">Configuración</h3>
                <div>
                    <label for="search-radius" class="form-label">Distancia de búsqueda: <span id="search-radius-label">2</span> km</label>
                    <input type="range" id="search-radius" name="search-radius" min="1" max="10" value="2" class="form-range">
                    <p class="form-text mt-1">Distancia máxima desde la ruta para buscar gasolineras.</p>
                </div>
                <div class="mt-3">
                    <div class="form-check">
                        <input type="checkbox" id="include-restricted" name="include-restricted" class="form-check-input">
                        <label for="include-restricted" class="form-check-label">Incluir gasolineras restringidas</label>
                    </div>
                    <p class="form-text mt-1">Estas vienen marcadas en la llamada como "Tipo Venta": "R" y son para uso de cooperativas, flotas, etc.</p>
                </div>
                                        <div class="mb-3">
                            <label class="form-label small">Algoritmo de cálculo</label>
                            <div class="d-flex flex-wrap gap-3">
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="radio" id="algo-greedy" name="algorithm" value="greedy" checked>
                                    <label class="form-check-label" for="algo-greedy">Codicioso (Greedy)</label>
                                </div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="radio" id="algo-dynamic" name="algorithm" value="dynamic">
                                    <label class="form-check-label" for="algo-dynamic">Programación Dinámica</label>
                                </div>
                            </div>
                        </div> 
            </div>

            <form id="route-form">
                <div class="mb-2 position-relative">
                    <div class="input-group">
                        <input type="text" id="origin" name="origin" class="form-control" placeholder="Origen" required>
                        <button type="button" id="locate-btn" class="btn btn-outline-secondary" title="Usar mi ubicación actual">
                            <i class="bi bi-geo-alt-fill"></i>
                        </button>
                    </div>
                    <div id="origin-suggestions" class="position-absolute z-3 w-100 bg-body border border-secondary-subtle rounded-bottom mt-1 d-none shadow-lg list-group"></div>
                </div>
                <div class="mb-2 position-relative">
                    <input type="text" id="destination" name="destination" class="form-control" placeholder="Destino" required>
                    <div id="destination-suggestions" class="position-absolute z-3 w-100 bg-body border border-secondary-subtle rounded-bottom mt-1 d-none shadow-lg list-group"></div>
                </div>
                <div class="row g-3 mb-2">
                    <div class="col-5">
                        <label for="fuel-type" class="form-label">Combustible</label>
                        <select id="fuel-type" name="fuel-type" class="form-select">
                            <option value="Precio Gasoleo A">Diésel</option>
                            <option value="Precio Gasolina 95 E5">Gasolina 95</option>
                            <option value="Precio Gasolina 98 E5">Gasolina 98</option>
                            <option value="Precio Gasoleo Premium">Diésel Premium</option>
                            <option value="Precio Gasoleo B">Gasoleo B</option>
                            <option value="Precio Gases licuados del petróleo">GLP</option>
                            <option value="Precio Gas Natural Comprimido">GNC</option>
                            <option value="Precio Gas Natural Licuado">GNL</option>
                        </select>
                    </div>
                    <div class="col-3">
                        <label for="tank-capacity" class="form-label">Depósito</label>
                        <div class="input-group">
                            <input type="number" id="tank-capacity" name="tank-capacity" value="55" class="form-control">
                            <span class="input-group-text mi-parrafo pl-1">L</span>
                        </div>
                    </div>
                    <div class="col-4">
                        <label for="consumption" class="form-label">Consumo</label>
                        <div class="input-group">
                            <input type="number" id="consumption" name="consumption" value="6.5" step="0.1" class="form-control" title="Consumo medio en L/100km">
                            <span class="input-group-text mi-parrafo pl-1">L/100</span>
                        </div>
                    </div>
                </div>
                <div class="mb-2">
                    <label for="current-fuel" class="form-label">Combustible actual: <span id="current-fuel-label">25%</span></label>
                    <input type="range" id="current-fuel" name="current-fuel" min="0" max="100" value="25" class="form-range">
                </div>
                <div class="mb-2">
                    <label for="final-fuel" class="form-label">Combustible final: <span id="final-fuel-label">25%</span></label>
                    <input type="range" id="final-fuel" name="final-fuel" min="0" max="90" value="25" class="form-range">
                </div>
                <button type="submit" id="search-button" class="btn btn-primary w-100 fw-bold py-2 mt-3">
                    Buscar Paradas Inteligentes
                </button>
                <button type="button" id="manual-search-button" class="btn btn-info w-100 fw-bold py-2 mt-2">
                    <i class="bi bi-list-check me-2"></i>
                    Buscar Paradas Manuales
                </button>
                <p class="form-text mt-1 small text-muted">Elige tus propias paradas de una lista de las 15 gasolineras más baratas en la ruta.</p>
            </form>

            <!-- Summary Section (hidden by default) -->

        </div>

        <!-- Results Section -->
        <div id="results-container" class=" flex-grow-1 overflow-y-auto d-none">
            <div id="results" class="space-y-3 ">
                
                <!-- Results will be injected here -->
            </div>
              <button type="button" id="new-route-btn" class="btn btn-secondary w-100 fw-bold py-2 mt-3">
                 Nueva Ruta
                </button><!--
            <div id="summary-container" class="d-none">
                 <button type="button" id="new-route-btn" class="btn btn-secondary w-100 fw-bold py-2 mt-3">
                 Nueva Ruta
                </button>
                <h3 class="h5 fw-bold text-body-emphasis mb-2 mt-3">Resumen del Viaje</h3>
                 <div id="summary-content" class="p-3 bg-body-tertiary rounded-3 border">
                     
                 </div>
-->
            </div>
        <!-- Loading/M
        </div>
essage Section -->
        <div id="message-container" class="mt-4 flex-grow-1 d-flex align-items-center justify-content-center text-center">
            <div id="message-content">
                <p class="text-muted">Introduce una ruta para comenzar.</p>
            </div>
        </div>
    </aside>

    <!-- Map Container -->
    <main id="map-container" class="flex-grow-1">
        <div id="map"></div>
    </main>

    <!-- Spinner Overlay -->
    <div id="spinner-overlay" class="d-none position-fixed top-0 start-0 w-100 h-100 bg-dark bg-opacity-50 d-flex align-items-center justify-content-center" style="z-index: 1056;">
        <div class="loader"></div>
    </div>

    <script src="dark-mode.js" defer></script>
    <script src="app.js" defer></script>
</body>
</html>
